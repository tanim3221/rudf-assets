!function(){function getLen(v){return Math.sqrt(v.x*v.x+v.y*v.y)}function dot(v1,v2){return v1.x*v2.x+v1.y*v2.y}function getAngle(v1,v2){var mr=getLen(v1)*getLen(v2);if(0===mr)return 0;var r=dot(v1,v2)/mr;return r>1&&(r=1),Math.acos(r)}function cross(v1,v2){return v1.x*v2.y-v2.x*v1.y}function getRotateAngle(v1,v2){var angle=getAngle(v1,v2);return cross(v1,v2)>0&&(angle*=-1),180*angle/Math.PI}var HandlerAdmin=function(el){this.handlers=[],this.el=el};function wrapFunc(el,handler){var handlerAdmin=new HandlerAdmin(el);return handlerAdmin.add(handler),handlerAdmin}HandlerAdmin.prototype.add=function(handler){this.handlers.push(handler)},HandlerAdmin.prototype.del=function(handler){handler||(this.handlers=[]);for(var i=this.handlers.length;i>=0;i--)this.handlers[i]===handler&&this.handlers.splice(i,1)},HandlerAdmin.prototype.dispatch=function(){for(var i=0,len=this.handlers.length;i<len;i++){var handler=this.handlers[i];"function"==typeof handler&&handler.apply(this.el,arguments)}};var AlloyFinger=function(el,option){this.element="string"==typeof el?document.querySelector(el):el,this.start=this.start.bind(this),this.move=this.move.bind(this),this.end=this.end.bind(this),this.cancel=this.cancel.bind(this),this.element.addEventListener("touchstart",this.start,!1),this.element.addEventListener("touchmove",this.move,!1),this.element.addEventListener("touchend",this.end,!1),this.element.addEventListener("touchcancel",this.cancel,!1),this.preV={x:null,y:null},this.pinchStartLen=null,this.scale=1,this.isDoubleTap=!1;var noop=function(){};this.rotate=wrapFunc(this.element,option.rotate||noop),this.touchStart=wrapFunc(this.element,option.touchStart||noop),this.multipointStart=wrapFunc(this.element,option.multipointStart||noop),this.multipointEnd=wrapFunc(this.element,option.multipointEnd||noop),this.pinch=wrapFunc(this.element,option.pinch||noop),this.swipe=wrapFunc(this.element,option.swipe||noop),this.tap=wrapFunc(this.element,option.tap||noop),this.doubleTap=wrapFunc(this.element,option.doubleTap||noop),this.longTap=wrapFunc(this.element,option.longTap||noop),this.singleTap=wrapFunc(this.element,option.singleTap||noop),this.pressMove=wrapFunc(this.element,option.pressMove||noop),this.touchMove=wrapFunc(this.element,option.touchMove||noop),this.touchEnd=wrapFunc(this.element,option.touchEnd||noop),this.touchCancel=wrapFunc(this.element,option.touchCancel||noop),this.delta=null,this.last=null,this.now=null,this.tapTimeout=null,this.singleTapTimeout=null,this.longTapTimeout=null,this.swipeTimeout=null,this.x1=this.x2=this.y1=this.y2=null,this.preTapPosition={x:null,y:null}};AlloyFinger.prototype={start:function(evt){if(evt.touches){this.now=Date.now(),this.x1=evt.touches[0].pageX,this.y1=evt.touches[0].pageY,this.delta=this.now-(this.last||this.now),this.touchStart.dispatch(evt),null!==this.preTapPosition.x&&(this.isDoubleTap=this.delta>0&&this.delta<=250&&Math.abs(this.preTapPosition.x-this.x1)<30&&Math.abs(this.preTapPosition.y-this.y1)<30),this.preTapPosition.x=this.x1,this.preTapPosition.y=this.y1,this.last=this.now;var preV=this.preV,len;if(evt.touches.length>1){this._cancelLongTap(),this._cancelSingleTap();var v={x:evt.touches[1].pageX-this.x1,y:evt.touches[1].pageY-this.y1};preV.x=v.x,preV.y=v.y,this.pinchStartLen=getLen(preV),this.multipointStart.dispatch(evt)}this.longTapTimeout=setTimeout(function(){this.longTap.dispatch(evt)}.bind(this),750)}},move:function(evt){if(evt.touches){var preV=this.preV,len=evt.touches.length,currentX=evt.touches[0].pageX,currentY=evt.touches[0].pageY;if(this.isDoubleTap=!1,len>1){var v={x:evt.touches[1].pageX-currentX,y:evt.touches[1].pageY-currentY};null!==preV.x&&(this.pinchStartLen>0&&(evt.scale=getLen(v)/this.pinchStartLen,this.pinch.dispatch(evt)),evt.angle=getRotateAngle(v,preV),this.rotate.dispatch(evt)),preV.x=v.x,preV.y=v.y}else null!==this.x2?(evt.deltaX=currentX-this.x2,evt.deltaY=currentY-this.y2):(evt.deltaX=0,evt.deltaY=0),this.pressMove.dispatch(evt);this.touchMove.dispatch(evt),this._cancelLongTap(),this.x2=currentX,this.y2=currentY,len>1&&evt.preventDefault()}},end:function(evt){if(evt.changedTouches){this._cancelLongTap();var self=this;evt.touches.length<2&&this.multipointEnd.dispatch(evt),this.touchEnd.dispatch(evt),this.x2&&Math.abs(this.x1-this.x2)>30||this.y2&&Math.abs(this.y1-this.y2)>30?(evt.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout((function(){self.swipe.dispatch(evt)}),0)):(this.tapTimeout=setTimeout((function(){self.tap.dispatch(evt),self.isDoubleTap&&(self.doubleTap.dispatch(evt),clearTimeout(self.singleTapTimeout),self.isDoubleTap=!1)}),0),self.isDoubleTap||(self.singleTapTimeout=setTimeout((function(){self.singleTap.dispatch(evt)}),250))),this.preV.x=0,this.preV.y=0,this.scale=1,this.pinchStartLen=null,this.x1=this.x2=this.y1=this.y2=null}},cancel:function(evt){clearTimeout(this.singleTapTimeout),clearTimeout(this.tapTimeout),clearTimeout(this.longTapTimeout),clearTimeout(this.swipeTimeout),this.touchCancel.dispatch(evt)},_cancelLongTap:function(){clearTimeout(this.longTapTimeout)},_cancelSingleTap:function(){clearTimeout(this.singleTapTimeout)},_swipeDirection:function(x1,x2,y1,y2){return Math.abs(x1-x2)>=Math.abs(y1-y2)?x1-x2>0?"Left":"Right":y1-y2>0?"Up":"Down"},on:function(evt,handler){this[evt]&&this[evt].add(handler)},off:function(evt,handler){this[evt]&&this[evt].del(handler)},destroy:function(){return this.singleTapTimeout&&clearTimeout(this.singleTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.swipeTimeout&&clearTimeout(this.swipeTimeout),this.element.removeEventListener("touchstart",this.start),this.element.removeEventListener("touchmove",this.move),this.element.removeEventListener("touchend",this.end),this.element.removeEventListener("touchcancel",this.cancel),this.rotate.del(),this.touchStart.del(),this.multipointStart.del(),this.multipointEnd.del(),this.pinch.del(),this.swipe.del(),this.tap.del(),this.doubleTap.del(),this.longTap.del(),this.singleTap.del(),this.pressMove.del(),this.touchMove.del(),this.touchEnd.del(),this.touchCancel.del(),this.preV=this.pinchStartLen=this.scale=this.isDoubleTap=this.delta=this.last=this.now=this.tapTimeout=this.singleTapTimeout=this.longTapTimeout=this.swipeTimeout=this.x1=this.x2=this.y1=this.y2=this.preTapPosition=this.rotate=this.touchStart=this.multipointStart=this.multipointEnd=this.pinch=this.swipe=this.tap=this.doubleTap=this.longTap=this.singleTap=this.pressMove=this.touchMove=this.touchEnd=this.touchCancel=null,null}},"undefined"!=typeof module&&"object"==typeof exports?module.exports=AlloyFinger:window.AlloyFinger=AlloyFinger}();